<!-- Overlay for mobile sidebar -->
@if(isMobileSidebarOpen()) {
  <div (click)="isMobileSidebarOpen.set(false)" class="fixed inset-0 bg-black/30 z-30 md:hidden"></div>
}

<div class="flex h-screen bg-white font-sans text-[#1A1A1A]">
  <!-- Sidebar -->
  <aside 
    data-sidebar
    class="bg-white flex flex-col transition-all duration-300 z-40 fixed inset-y-0 left-0 md:relative md:translate-x-0 border-r border-transparent"
    [class.-translate-x-full]="!isMobileSidebarOpen()"
    [class.translate-x-0]="isMobileSidebarOpen()"
    [class.w-[240px]]="!isSidebarCollapsed()"
    [class.w-20]="isSidebarCollapsed()">
    
    <!-- Logo and Collapse Toggle -->
    <div class="h-20 flex items-center justify-between px-6 flex-shrink-0">
        <a routerLink="/dashboard" class="flex items-center space-x-2 group">
            <!-- New "Plan" Logo Icon -->
             <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2.33331L2.33333 8.16665V21L14 26.8333L25.6667 21V8.16665L14 2.33331Z" stroke="black" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2.33333 8.16666L14 14L25.6667 8.16666" stroke="black" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 26.8333V14" stroke="black" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
             @if (!isSidebarCollapsed()) {
               <span class="text-2xl font-bold tracking-tight text-black">Plan</span>
             }
        </a>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 overflow-y-auto py-2 px-3">
      <ul class="space-y-1">
        <!-- Overview -->
        <li>
          <a [routerLink]="baseRoute() + '/overview'" routerLinkActive="bg-gray-100 text-black font-semibold" [routerLinkActiveOptions]="{exact: true}" class="flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors" [class.justify-center]="isSidebarCollapsed()">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
            @if(!isSidebarCollapsed()) { <span class="text-[15px]">Overview</span> }
          </a>
        </li>
        
        <!-- Contacts (Active State Mockup based on design) -->
        <li>
           <div class="space-y-1">
               <a [routerLink]="baseRoute() + '/contacts'" routerLinkActive="bg-gray-100 text-black font-bold" class="flex items-center justify-between px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors group cursor-pointer" [class.justify-center]="isSidebarCollapsed()">
                  <div class="flex items-center space-x-3">
                      <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      @if(!isSidebarCollapsed()) { <span class="text-[15px]">Contacts</span> }
                  </div>
                  @if(!isSidebarCollapsed()) { 
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" /></svg>
                  }
               </a>
               
               <!-- Sub-menu for Contacts (Hardcoded open state for visual match if active) -->
               @if(!isSidebarCollapsed()) {
                   <div class="pl-4 space-y-1" routerLinkActive="block" [routerLinkActiveOptions]="{exact: false}" #rla="routerLinkActive">
                        <a [routerLink]="baseRoute() + '/contacts'" routerLinkActive="bg-white shadow-sm text-black font-semibold" [routerLinkActiveOptions]="{exact: true}" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-500 hover:text-black hover:bg-gray-50 transition-colors text-sm">
                            Leads
                        </a>
                        <a [routerLink]="baseRoute() + '/referral-partners'" routerLinkActive="bg-white shadow-sm text-black font-semibold" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-500 hover:text-black hover:bg-gray-50 transition-colors text-sm">
                            Referral Partners
                        </a>
                   </div>
               }
           </div>
        </li>

         <!-- Deals -->
         <li>
          <a [routerLink]="baseRoute() + '/deals'" routerLinkActive="bg-gray-100 text-black font-semibold" [routerLinkActiveOptions]="{exact: true}" class="flex items-center justify-between px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors group" [class.justify-center]="isSidebarCollapsed()">
              <div class="flex items-center space-x-3">
                 <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                   @if(!isSidebarCollapsed()) { <span class="text-[15px]">Deals</span> }
              </div>
              @if(!isSidebarCollapsed()) { 
                  <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              }
          </a>
        </li>

         <!-- Integration -->
         <li>
          <a [routerLink]="baseRoute() + '/integration'" routerLinkActive="bg-gray-100 text-black font-semibold" [routerLinkActiveOptions]="{exact: true}" class="flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors" [class.justify-center]="isSidebarCollapsed()">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                 <path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
              </svg>
            @if(!isSidebarCollapsed()) { <span class="text-[15px]">Integration</span> }
          </a>
        </li>

         <!-- Tasks -->
         <li>
          <a [routerLink]="baseRoute() + '/tasks'" routerLinkActive="bg-gray-100 text-black font-semibold" [routerLinkActiveOptions]="{exact: true}" class="flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors" [class.justify-center]="isSidebarCollapsed()">
            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
            @if(!isSidebarCollapsed()) { <span class="text-[15px]">Tasks</span> }
          </a>
        </li>
      </ul>
    </nav>
    
    <!-- Footer Nav (Settings & Help) -->
    <div class="flex-shrink-0 mb-6">
        <ul class="space-y-1 px-3">
           <li>
              <a [routerLink]="baseRoute() + '/settings'" routerLinkActive="bg-gray-100 text-black font-semibold" [routerLinkActiveOptions]="{exact: true}" class="flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors" [class.justify-center]="isSidebarCollapsed()">
                 <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                   <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                   <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                 </svg>
                @if(!isSidebarCollapsed()) { <span class="text-[15px]">Settings</span> }
              </a>
            </li>
             <li>
              <a href="#" class="flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-500 hover:bg-gray-50 transition-colors" [class.justify-center]="isSidebarCollapsed()">
                 <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                 </svg>
                @if(!isSidebarCollapsed()) { 
                    <div class="flex items-center justify-between w-full">
                        <span class="text-[15px]">Help & Support</span>
                        <span class="bg-blue-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded">8</span>
                    </div>
                 }
              </a>
            </li>
        </ul>
    </div>
  </aside>

  <!-- Main content -->
  <div class="flex-1 flex flex-col overflow-hidden bg-white">
    <!-- Header -->
    <header class="h-20 flex items-center justify-between px-8 bg-white">
      <div>
        <button (click)="toggleMobileSidebar($event)" class="p-2 -ml-2 rounded-md text-gray-600 md:hidden">
           <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        
        <!-- Desktop Search Bar -->
        <div class="hidden md:flex relative w-[400px]">
             <span class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                <svg class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
            </span>
            <input type="text" placeholder="Search or type a command" class="w-full pl-11 pr-4 py-3 border-0 rounded-sm bg-gray-50 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-0 text-[15px]">
        </div>
      </div>
      
      <div class="flex-1 flex justify-end items-center space-x-6">
        <!-- New Icons from Design -->
         <button class="text-gray-400 hover:text-black transition-colors transform hover:scale-110">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
         </button>
         
         <button class="text-gray-400 hover:text-black transition-colors transform hover:scale-110">
             <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
             </svg>
         </button>

         <button class="text-gray-400 hover:text-black transition-colors transform hover:scale-110 relative">
             <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
             </svg>
             <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
         </button>

        <!-- Profile dropdown -->
        <div data-profile-dropdown class="relative">
          <button (click)="toggleProfileDropdown($event)" class="rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
            <img ngSrc="https://i.pravatar.cc/40?u=profile" width="40" height="40" alt="User Avatar" class="rounded-full border border-gray-200">
          </button>
          
          @if (isProfileDropdownOpen()) {
            <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-50 border border-gray-100 ring-1 ring-black ring-opacity-5">
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Your Profile</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Settings</a>
              <a (click)="logout()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">Sign out</a>
            </div>
          }
        </div>
      </div>
    </header>

    <!-- Main content area -->
    <router-outlet></router-outlet>
    <app-dashboard-testimonials></app-dashboard-testimonials>
  </div>
</div>